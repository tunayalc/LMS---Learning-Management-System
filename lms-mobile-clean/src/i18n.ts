import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import { getLocales } from 'expo-localization';
import AsyncStorage from '@react-native-async-storage/async-storage';

const LANGUAGE_STORAGE_KEY = 'user-language';
const supportedLanguages = ['tr', 'en', 'de', 'fr'] as const;
type SupportedLanguage = (typeof supportedLanguages)[number];

const resolveInitialLanguage = (): SupportedLanguage => {
    const deviceLanguage = (getLocales()[0]?.languageCode ?? 'tr').toLowerCase();
    return (supportedLanguages as readonly string[]).includes(deviceLanguage)
        ? (deviceLanguage as SupportedLanguage)
        : 'tr';
};

const resources = {
    en: {
        translation: {
            // General
            "welcome": "Welcome",
            "login": "Login",
            "logout": "Logout",
            "loading": "Loading...",
            "error": "Error",
            "success": "Success",
            "cancel": "Cancel",
            "save": "Save",
            "delete": "Delete",
            "edit": "Edit",
            "create": "Create",
            "update": "Update",
            "refresh": "Refresh",
            "back": "Back",
            "next": "Next",
            "submit": "Submit",
            "confirm": "Confirm",
            "close": "Close",
            "status": "Status",
            "appearance": "Appearance",
            "server_url": "Server URL",
            "settings_saved_restart": "Settings saved. Restart the app to apply changes.",
            "test_connection": "Test",
            "connection_ok": "Connection OK",
            "connection_failed": "Connection failed",
            "theme_light": "Light",
            "theme_dark": "Dark",
            "theme_system": "System",
            // Auth
            "username": "Username",
            "password": "Password",
            "biometric_login": "Biometric Login",
            "guest_login": "Guest Login",
            // Courses
            "course_list": "Course List",
            "course_detail": "Course Detail",
            "enroll": "Enroll",
            "enrolled": "Enrolled",
            "browse_courses": "Browse Courses",
            "no_courses": "No courses yet.",
            // Content
            "content": "Content",
            "video": "Video",
            "pdf": "PDF",
            "live_class": "Live Class",
            "download": "Download",
            "open_pdf": "Open PDF",
            "join_class": "Join Class",
            // Exams
            "exams": "Exams",
            "exam_detail": "Exam Detail",
            "start_exam": "Start Exam",
            "submit_exam": "Submit Exam",
            "time_remaining": "Time Remaining",
            "score": "Score",
            "passed": "Passed",
            "failed": "Failed",
            "omr_scan": "OMR Scan",
            "camera_permission_required": "We need camera permission to use the camera.",
            "grant_permission": "Grant Permission",
            "omr_align_corners": "Align the 4 corners of the paper within the frame.",
            "omr_perspective_active": "Automatic perspective correction is active.",
            "omr_threshold_label": "Threshold",
            "omr_x_offset_label": "X Offset",
            "omr_y_offset_label": "Y Offset",
            "omr_smart_align_label": "Smart Align",
            "omr_skip_warp_label": "Skip Warp",
            "omr_debug_label": "Debug",
            "retake_photo": "Retake",
            "upload_and_grade": "Grade & Upload",
            "sheet_scanned": "Sheet scanned!",
            "next_sheet": "Next sheet (batch)",
            "exam_id_missing": "Exam ID not found. Please open this from the exam details.",
            "scan_failed_try_again": "Scan failed. Please try again.",
            "photo_capture_failed": "Photo could not be captured.",
            "exam_mobile_blocked_title": "Access blocked",
            "exam_mobile_blocked_message": "Due to exam security rules, you cannot take this exam from a mobile device.",
            "exam_mobile_blocked_hint": "Please use Safe Exam Browser (SEB) on your computer.",
            // Questions
            "questions": "Questions",
            "question": "Question",
            "answer": "Answer",
            "options": "Options",
            "correct": "Correct",
            "incorrect": "Incorrect",
            // Settings
            "settings": "Settings",
            "language": "Language",
            "theme": "Theme",
            "dark_mode": "Dark Mode",
            "light_mode": "Light Mode",
            // Offline
            "offline_mode": "Offline Mode",
            "no_internet": "No Internet Connection",
            // Misc
            "users": "Users",
            "role": "Role",
            "admin_panel": "Admin Panel",

            // Admin / Instructor tools
            "info": "Info",
            "active_courses": "Active Courses",
            "system_management": "System Management",
            "education_management": "Education Management",
            "create_user": "Add User",
            "system_settings": "System Settings",
            "system_settings_web_only": "System settings must be configured from the web panel.",
            "create_course": "Create Course",
            "create_exam": "Create Exam",
            "upload_content": "Upload Content",
            "content_upload_coming_soon": "Content upload will be available soon.",

            // Create Course
            "course_title": "Course Title",
            "description": "Description",
            "course_title_placeholder": "e.g. Mathematics 101",
            "course_description_placeholder": "Short info about the course...",
            "course_title_required": "Course title is required.",
            "course_created": "Course created.",
            "course_create_failed": "Course could not be created.",

            // Create Exam
            "select_course": "Select Course",
            "courses_load_failed": "Courses could not be loaded.",
            "exam_title": "Exam Title",
            "exam_title_placeholder": "e.g. Midterm Exam",
            "duration_minutes": "Duration (min)",
            "pass_threshold": "Passing Score",
            "select_course_required": "Please select a course.",
            "exam_title_required": "Exam title is required.",
            "exam_created": "Exam created.",
            "exam_create_failed": "Exam could not be created.",

            // Create User
            "email": "Email",
            "all_fields_required": "Please fill in all fields.",
            "user_created": "User created.",
            "user_create_failed": "User could not be created.",
            "role_student": "Student",
            "role_instructor": "Instructor",
            "role_admin": "Admin",

            // Notes
            "notes": "Notes",
            "add": "Add",
            "add_note_placeholder": "Add a note...",
            "note_text_required": "Note text cannot be empty.",
            "note_save_failed": "Note could not be saved.",
            "delete_note": "Delete Note",
            "delete_note_confirm": "Are you sure you want to delete this note?",
            "note_delete_failed": "Note could not be deleted.",
            "note_saved_at": "Note will be saved at current position: {{time}}",
            "no_notes": "No notes yet.",
            "no_notes_hint": "Add a new note above."
        }
    },
    tr: {
        translation: {
            // General
            "welcome": "Hoş Geldiniz",
            "login": "Giriş Yap",
            "logout": "Çıkış Yap",
            "loading": "Yükleniyor...",
            "error": "Hata",
            "success": "Başarılı",
            "cancel": "İptal",
            "save": "Kaydet",
            "delete": "Sil",
            "edit": "Düzenle",
            "create": "Oluştur",
            "update": "Güncelle",
            "refresh": "Yenile",
            "back": "Geri",
            "next": "İleri",
            "submit": "Gönder",
            "confirm": "Onayla",
            "close": "Kapat",
            "status": "Durum",
            "appearance": "Görünüm",
            "server_url": "Sunucu Adresi",
            "settings_saved_restart": "Ayarlar kaydedildi. Değişiklikler için uygulamayı yeniden başlatın.",
            "test_connection": "Test Et",
            "connection_ok": "Bağlantı başarılı",
            "connection_failed": "Bağlantı başarısız",
            "theme_light": "Açık",
            "theme_dark": "Koyu",
            "theme_system": "Sistem",
            // Auth
            "username": "Kullanıcı Adı",
            "password": "Şifre",
            "biometric_login": "Biyometrik Giriş",
            "guest_login": "Misafir Girişi",
            // Courses
            "course_list": "Kurs Listesi",
            "course_detail": "Kurs Detayı",
            "enroll": "Kayıt Ol",
            "enrolled": "Kayıtlı",
            "browse_courses": "Kurs Keşfet",
            "no_courses": "Henüz kurs yok.",
            // Content
            "content": "İçerik",
            "video": "Video",
            "pdf": "PDF",
            "live_class": "Canlı Ders",
            "download": "İndir",
            "open_pdf": "PDF Aç",
            "join_class": "Derse Katıl",
            // Exams
            "exams": "Sınavlar",
            "exam_detail": "Sınav Detayı",
            "start_exam": "Sınavı Başlat",
            "submit_exam": "Sınavı Gönder",
            "time_remaining": "Kalan Süre",
            "score": "Puan",
            "passed": "Geçti",
            "failed": "Kaldı",
            "omr_scan": "Optik Okuma",
            "camera_permission_required": "Kamerayı kullanmak için izne ihtiyacımız var.",
            "grant_permission": "İzin Ver",
            "omr_align_corners": "Kağıdın 4 köşesini çerçeveye hizalayın.",
            "omr_perspective_active": "Otomatik perspektif düzeltme aktiftir.",
            "omr_threshold_label": "Eşik Değeri",
            "omr_x_offset_label": "X Ofset",
            "omr_y_offset_label": "Y Ofset",
            "omr_smart_align_label": "Akıllı Hizalama",
            "omr_skip_warp_label": "Warp'ı Atla",
            "omr_debug_label": "Hata Ayıklama",
            "retake_photo": "Tekrar Çek",
            "upload_and_grade": "Puanla ve Gönder",
            "sheet_scanned": "Kağıt Okundu!",
            "next_sheet": "Sıradaki Kağıt (Batch)",
            "exam_id_missing": "Sınav ID bulunamadı. Lütfen sınav detayından girin.",
            "scan_failed_try_again": "Tarama başarısız oldu. Lütfen tekrar deneyin.",
            "photo_capture_failed": "Fotoğraf çekilemedi.",
            "exam_mobile_blocked_title": "Erişim Engellendi",
            "exam_mobile_blocked_message": "Sınav güvenliği kuralları gereği, bu sınava mobil cihaz üzerinden giriş yapamazsınız.",
            "exam_mobile_blocked_hint": "Lütfen bilgisayarınızdan Safe Exam Browser (SEB) kullanarak giriş yapınız.",
            // Questions
            "questions": "Sorular",
            "question": "Soru",
            "answer": "Cevap",
            "options": "Seçenekler",
            "correct": "Doğru",
            "incorrect": "Yanlış",
            // Settings
            "settings": "Ayarlar",
            "language": "Dil",
            "theme": "Tema",
            "dark_mode": "Karanlık Mod",
            "light_mode": "Aydınlık Mod",
            // Offline
            "offline_mode": "Çevrimdışı Mod",
            "no_internet": "İnternet Bağlantısı Yok",
            // Misc
            "users": "Kullanıcılar",
            "role": "Rol",
            "admin_panel": "Yönetici Paneli",

            // Admin / Instructor tools
            "info": "Bilgi",
            "active_courses": "Aktif Dersler",
            "system_management": "Sistem Yönetimi",
            "education_management": "Eğitim Yönetimi",
            "create_user": "Kullanıcı Ekle",
            "system_settings": "Sistem Ayarları",
            "system_settings_web_only": "Sistem ayarları web panelinden yapılmalıdır.",
            "create_course": "Ders Oluştur",
            "create_exam": "Sınav Oluştur",
            "upload_content": "İçerik Yükle",
            "content_upload_coming_soon": "İçerik yükleme özelliği yakında aktif olacak.",

            // Create Course
            "course_title": "Kurs Başlığı",
            "description": "Açıklama",
            "course_title_placeholder": "Örn: Matematik 101",
            "course_description_placeholder": "Ders içeriği hakkında kısa bilgi...",
            "course_title_required": "Ders başlığı gereklidir.",
            "course_created": "Ders oluşturuldu.",
            "course_create_failed": "Ders oluşturulamadı.",

            // Create Exam
            "select_course": "Ders Seçiniz",
            "courses_load_failed": "Dersler yüklenemedi.",
            "exam_title": "Sınav Başlığı",
            "exam_title_placeholder": "Örn: Vize Sınavı",
            "duration_minutes": "Süre (dk)",
            "pass_threshold": "Geçme Notu",
            "select_course_required": "Lütfen bir ders seçin.",
            "exam_title_required": "Sınav başlığı gereklidir.",
            "exam_created": "Sınav oluşturuldu.",
            "exam_create_failed": "Sınav oluşturulamadı.",

            // Create User
            "email": "E-posta",
            "all_fields_required": "Lütfen tüm alanları doldurun.",
            "user_created": "Kullanıcı oluşturuldu.",
            "user_create_failed": "Kullanıcı oluşturulamadı.",
            "role_student": "Öğrenci",
            "role_instructor": "Öğretmen",
            "role_admin": "Yönetici",

            // Notes
            "notes": "Notlar",
            "add": "Ekle",
            "add_note_placeholder": "Yeni not ekle...",
            "note_text_required": "Not metni boş olamaz.",
            "note_save_failed": "Not kaydedilemedi.",
            "delete_note": "Notu Sil",
            "delete_note_confirm": "Bu notu silmek istediğinize emin misiniz?",
            "note_delete_failed": "Not silinemedi.",
            "note_saved_at": "Not şu anki pozisyona kaydedilecek: {{time}}",
            "no_notes": "Henüz not yok.",
            "no_notes_hint": "Yukarıdan yeni not ekleyebilirsiniz."
        }
    },
    de: {
        translation: {
            // General
            "welcome": "Willkommen",
            "login": "Anmelden",
            "logout": "Abmelden",
            "loading": "Lädt...",
            "error": "Fehler",
            "success": "Erfolg",
            "cancel": "Abbrechen",
            "save": "Speichern",
            "delete": "Löschen",
            "edit": "Bearbeiten",
            "create": "Erstellen",
            "update": "Aktualisieren",
            "refresh": "Aktualisieren",
            "back": "Zurück",
            "next": "Weiter",
            "submit": "Absenden",
            "confirm": "Bestätigen",
            "close": "Schließen",
            "status": "Status",
            "appearance": "Darstellung",
            "server_url": "Server-URL",
            "settings_saved_restart": "Einstellungen gespeichert. Starte die App neu, um Änderungen anzuwenden.",
            "test_connection": "Testen",
            "connection_ok": "Verbindung OK",
            "connection_failed": "Verbindung fehlgeschlagen",
            "theme_light": "Hell",
            "theme_dark": "Dunkel",
            "theme_system": "System",
            // Auth
            "username": "Benutzername",
            "password": "Passwort",
            "biometric_login": "Biometrische Anmeldung",
            "guest_login": "Gast-Anmeldung",
            // Courses
            "course_list": "Kursliste",
            "course_detail": "Kursdetails",
            "enroll": "Einschreiben",
            "enrolled": "Eingeschrieben",
            "browse_courses": "Kurse durchsuchen",
            "no_courses": "Noch keine Kurse.",
            // Content
            "content": "Inhalt",
            "video": "Video",
            "pdf": "PDF",
            "live_class": "Live-Unterricht",
            "download": "Herunterladen",
            "open_pdf": "PDF öffnen",
            "join_class": "Unterricht beitreten",
            // Exams
            "exams": "Prüfungen",
            "exam_detail": "Prüfungsdetails",
            "start_exam": "Prüfung starten",
            "submit_exam": "Prüfung abgeben",
            "time_remaining": "Verbleibende Zeit",
            "score": "Punktzahl",
            "passed": "Bestanden",
            "failed": "Nicht bestanden",
            "omr_scan": "OMR-Scan",
            "camera_permission_required": "Wir benötigen Kameraberechtigung, um die Kamera zu verwenden.",
            "grant_permission": "Berechtigen",
            "omr_align_corners": "Richten Sie die 4 Ecken des Blatts im Rahmen aus.",
            "omr_perspective_active": "Automatische Perspektivkorrektur ist aktiv.",
            "omr_threshold_label": "Schwellenwert",
            "omr_x_offset_label": "X-Versatz",
            "omr_y_offset_label": "Y-Versatz",
            "omr_smart_align_label": "Intelligente Ausrichtung",
            "omr_skip_warp_label": "Warp überspringen",
            "omr_debug_label": "Debug",
            "retake_photo": "Neu aufnehmen",
            "upload_and_grade": "Bewerten & Senden",
            "sheet_scanned": "Blatt erkannt!",
            "next_sheet": "Nächstes Blatt (Batch)",
            "exam_id_missing": "Prüfungs-ID nicht gefunden. Bitte aus den Prüfungsdetails öffnen.",
            "scan_failed_try_again": "Scan fehlgeschlagen. Bitte erneut versuchen.",
            "photo_capture_failed": "Foto konnte nicht aufgenommen werden.",
            "exam_mobile_blocked_title": "Zugriff blockiert",
            "exam_mobile_blocked_message": "Aus Sicherheitsgründen kann diese Prüfung nicht auf einem Mobilgerät durchgeführt werden.",
            "exam_mobile_blocked_hint": "Bitte verwenden Sie Safe Exam Browser (SEB) auf Ihrem Computer.",
            // Questions
            "questions": "Fragen",
            "question": "Frage",
            "answer": "Antwort",
            "options": "Optionen",
            "correct": "Richtig",
            "incorrect": "Falsch",
            // Settings
            "settings": "Einstellungen",
            "language": "Sprache",
            "theme": "Thema",
            "dark_mode": "Dunkelmodus",
            "light_mode": "Hellmodus",
            // Offline
            "offline_mode": "Offline-Modus",
            "no_internet": "Keine Internetverbindung",
            // Misc
            "users": "Benutzer",
            "role": "Rolle",
            "admin_panel": "Admin-Panel",

            // Admin / Instructor tools
            "info": "Info",
            "active_courses": "Aktive Kurse",
            "system_management": "Systemverwaltung",
            "education_management": "Kursverwaltung",
            "create_user": "Benutzer hinzufügen",
            "system_settings": "Systemeinstellungen",
            "system_settings_web_only": "Systemeinstellungen müssen im Web-Panel konfiguriert werden.",
            "create_course": "Kurs erstellen",
            "create_exam": "Prüfung erstellen",
            "upload_content": "Inhalte hochladen",
            "content_upload_coming_soon": "Der Upload von Inhalten wird bald verfügbar sein.",

            // Create Course
            "course_title": "Kurstitel",
            "description": "Beschreibung",
            "course_title_placeholder": "z. B. Mathematik 101",
            "course_description_placeholder": "Kurze Info zum Kurs...",
            "course_title_required": "Kurstitel ist erforderlich.",
            "course_created": "Kurs erstellt.",
            "course_create_failed": "Kurs konnte nicht erstellt werden.",

            // Create Exam
            "select_course": "Kurs auswählen",
            "courses_load_failed": "Kurse konnten nicht geladen werden.",
            "exam_title": "Prüfungstitel",
            "exam_title_placeholder": "z. B. Zwischenprüfung",
            "duration_minutes": "Dauer (Min.)",
            "pass_threshold": "Bestehensgrenze",
            "select_course_required": "Bitte wählen Sie einen Kurs aus.",
            "exam_title_required": "Prüfungstitel ist erforderlich.",
            "exam_created": "Prüfung erstellt.",
            "exam_create_failed": "Prüfung konnte nicht erstellt werden.",

            // Create User
            "email": "E-Mail",
            "all_fields_required": "Bitte füllen Sie alle Felder aus.",
            "user_created": "Benutzer erstellt.",
            "user_create_failed": "Benutzer konnte nicht erstellt werden.",
            "role_student": "Student",
            "role_instructor": "Dozent",
            "role_admin": "Admin",

            // Notes
            "notes": "Notizen",
            "add": "Hinzufügen",
            "add_note_placeholder": "Neue Notiz hinzufügen...",
            "note_text_required": "Der Notiztext darf nicht leer sein.",
            "note_save_failed": "Notiz konnte nicht gespeichert werden.",
            "delete_note": "Notiz löschen",
            "delete_note_confirm": "Möchten Sie diese Notiz wirklich löschen?",
            "note_delete_failed": "Notiz konnte nicht gelöscht werden.",
            "note_saved_at": "Notiz wird an der aktuellen Position gespeichert: {{time}}",
            "no_notes": "Noch keine Notizen.",
            "no_notes_hint": "Fügen Sie oben eine neue Notiz hinzu."
        }
    },
    fr: {
        translation: {
            // General
            "welcome": "Bienvenue",
            "login": "Connexion",
            "logout": "Déconnexion",
            "loading": "Chargement...",
            "error": "Erreur",
            "success": "Succès",
            "cancel": "Annuler",
            "save": "Enregistrer",
            "delete": "Supprimer",
            "edit": "Modifier",
            "create": "Créer",
            "update": "Mettre à jour",
            "refresh": "Actualiser",
            "back": "Retour",
            "next": "Suivant",
            "submit": "Soumettre",
            "confirm": "Confirmer",
            "close": "Fermer",
            "status": "Statut",
            "appearance": "Apparence",
            "server_url": "URL du serveur",
            "settings_saved_restart": "Paramètres enregistrés. Redémarrez l'application pour appliquer les changements.",
            "test_connection": "Tester",
            "connection_ok": "Connexion OK",
            "connection_failed": "Échec de connexion",
            "theme_light": "Clair",
            "theme_dark": "Sombre",
            "theme_system": "Système",
            // Auth
            "username": "Nom d'utilisateur",
            "password": "Mot de passe",
            "biometric_login": "Connexion biométrique",
            "guest_login": "Connexion invité",
            // Courses
            "course_list": "Liste des cours",
            "course_detail": "Détails du cours",
            "enroll": "S'inscrire",
            "enrolled": "Inscrit",
            "browse_courses": "Parcourir les cours",
            "no_courses": "Aucun cours pour le moment.",
            // Content
            "content": "Contenu",
            "video": "Vidéo",
            "pdf": "PDF",
            "live_class": "Cours en direct",
            "download": "Télécharger",
            "open_pdf": "Ouvrir le PDF",
            "join_class": "Rejoindre le cours",
            // Exams
            "exams": "Examens",
            "exam_detail": "Détails de l'examen",
            "start_exam": "Commencer l'examen",
            "submit_exam": "Soumettre l'examen",
            "time_remaining": "Temps restant",
            "score": "Score",
            "passed": "Réussi",
            "failed": "Échoué",
            "omr_scan": "Scan OMR",
            "camera_permission_required": "Nous avons besoin de l'autorisation caméra pour l'utiliser.",
            "grant_permission": "Autoriser",
            "omr_align_corners": "Alignez les 4 coins de la feuille dans le cadre.",
            "omr_perspective_active": "La correction de perspective automatique est active.",
            "omr_threshold_label": "Seuil",
            "omr_x_offset_label": "Décalage X",
            "omr_y_offset_label": "Décalage Y",
            "omr_smart_align_label": "Alignement intelligent",
            "omr_skip_warp_label": "Ignorer le warp",
            "omr_debug_label": "Debug",
            "retake_photo": "Reprendre",
            "upload_and_grade": "Noter et envoyer",
            "sheet_scanned": "Feuille scannée !",
            "next_sheet": "Feuille suivante (batch)",
            "exam_id_missing": "ID d’examen introuvable. Ouvrez ceci depuis les détails de l’examen.",
            "scan_failed_try_again": "Échec du scan. Veuillez réessayer.",
            "photo_capture_failed": "La photo n’a pas pu être prise.",
            "exam_mobile_blocked_title": "Accès bloqué",
            "exam_mobile_blocked_message": "Pour des raisons de sécurité, vous ne pouvez pas passer cet examen sur mobile.",
            "exam_mobile_blocked_hint": "Veuillez utiliser Safe Exam Browser (SEB) sur votre ordinateur.",
            // Questions
            "questions": "Questions",
            "question": "Question",
            "answer": "Réponse",
            "options": "Options",
            "correct": "Correct",
            "incorrect": "Incorrect",
            // Settings
            "settings": "Paramètres",
            "language": "Langue",
            "theme": "Thème",
            "dark_mode": "Mode sombre",
            "light_mode": "Mode clair",
            // Offline
            "offline_mode": "Mode hors-ligne",
            "no_internet": "Pas de connexion Internet",
            // Misc
            "users": "Utilisateurs",
            "role": "Rôle",
            "admin_panel": "Panneau d'administration",

            // Admin / Instructor tools
            "info": "Info",
            "active_courses": "Cours actifs",
            "system_management": "Gestion du système",
            "education_management": "Gestion des cours",
            "create_user": "Ajouter un utilisateur",
            "system_settings": "Paramètres système",
            "system_settings_web_only": "Les paramètres système doivent être configurés depuis le panneau web.",
            "create_course": "Créer un cours",
            "create_exam": "Créer un examen",
            "upload_content": "Téléverser du contenu",
            "content_upload_coming_soon": "Le téléversement de contenu sera bientôt disponible.",

            // Create Course
            "course_title": "Titre du cours",
            "description": "Description",
            "course_title_placeholder": "Ex : Mathématiques 101",
            "course_description_placeholder": "Courte info sur le cours...",
            "course_title_required": "Le titre du cours est requis.",
            "course_created": "Cours créé.",
            "course_create_failed": "Le cours n'a pas pu être créé.",

            // Create Exam
            "select_course": "Sélectionner un cours",
            "courses_load_failed": "Les cours n'ont pas pu être chargés.",
            "exam_title": "Titre de l'examen",
            "exam_title_placeholder": "Ex : Examen de mi-semestre",
            "duration_minutes": "Durée (min)",
            "pass_threshold": "Note de passage",
            "select_course_required": "Veuillez sélectionner un cours.",
            "exam_title_required": "Le titre de l'examen est requis.",
            "exam_created": "Examen créé.",
            "exam_create_failed": "L'examen n'a pas pu être créé.",

            // Create User
            "email": "E-mail",
            "all_fields_required": "Veuillez remplir tous les champs.",
            "user_created": "Utilisateur créé.",
            "user_create_failed": "L'utilisateur n'a pas pu être créé.",
            "role_student": "Étudiant",
            "role_instructor": "Enseignant",
            "role_admin": "Admin",

            // Notes
            "notes": "Notes",
            "add": "Ajouter",
            "add_note_placeholder": "Ajouter une note...",
            "note_text_required": "Le texte de la note ne peut pas être vide.",
            "note_save_failed": "La note n'a pas pu être enregistrée.",
            "delete_note": "Supprimer la note",
            "delete_note_confirm": "Voulez-vous vraiment supprimer cette note ?",
            "note_delete_failed": "La note n'a pas pu être supprimée.",
            "note_saved_at": "La note sera enregistrée à la position actuelle : {{time}}",
            "no_notes": "Aucune note pour le moment.",
            "no_notes_hint": "Ajoutez une nouvelle note ci-dessus."
        }
    }
};

i18n
    .use(initReactI18next)
    .init({
        resources,
        lng: resolveInitialLanguage(),
        fallbackLng: 'tr',
        interpolation: {
            escapeValue: false
        }
    });

// Apply saved language preference (if any) after init.
AsyncStorage.getItem(LANGUAGE_STORAGE_KEY)
    .then((saved) => {
        if (saved && (supportedLanguages as readonly string[]).includes(saved) && saved !== i18n.language) {
            i18n.changeLanguage(saved);
        }
    })
    .catch(() => {
        // Ignore storage errors: fallback to device language / default.
    });

export default i18n;
